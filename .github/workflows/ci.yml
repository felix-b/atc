name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build-linux:
    runs-on: ubuntu-latest
    steps:

      - name: print environment
        run: |
          uname -a
          gcc --version
          cmake --version
          echo "GITHUB_WORKSPACE=${GITHUB_WORKSPACE}"

      - name: install deps
        run: |
          sudo sed -i -e 's/http:\/\/archive.ubuntu.com\/ubuntu\//mirror:\/\/mirrors.ubuntu.com\/mirrors.txt/' /etc/apt/sources.list && sudo apt-get update
          sudo apt-get install -y --no-install-recommends freeglut3-dev

      - name: checkout
        uses: actions/checkout@v2
        with: 
          submodules: 'recursive'

      - name: build all
        run: |
          cd ${GITHUB_WORKSPACE}/tasks
          ls -la
          chmod +x build-all.sh
          ./build-all.sh

  build-mac:
    runs-on: macos-latest
    steps:

      - name: print environment
        run: |
          uname -a
          gcc --version
          cmake --version
          echo "GITHUB_WORKSPACE=${GITHUB_WORKSPACE}"

      - name: checkout
        uses: actions/checkout@v2
        with: 
          submodules: 'recursive'

      - name: build all
        run: |
          cd ${GITHUB_WORKSPACE}/tasks
          ls -la
          chmod +x build-all.sh
          ./build-all.sh

  build-windows:
    runs-on: windows-latest
    steps:

      - name: print environment
        run: |
          echo "GITHUB_WORKSPACE=${env:GITHUB_WORKSPACE}"
          gcc --version
          cmake --version

      - name: checkout
        uses: actions/checkout@v2
        with: 
          submodules: 'recursive'

      - name: build all
        run: tasks\build-all.cmd
